# Проектирование высоконагруженного пространства для командной работы
Курсовая работа в рамках 3-го семестра программы по Веб-разработке ОЦ VK x МГТУ им. Н.Э. Баумана (ex. "Технопарк") по дисциплине "Проектирование высоконагруженных сервисов"

__Автор__ - [AlfaIV](https://github.com/alfaiv)</br>
__Задание__ - [Методические указания](https://github.com/init/highload/blob/main/homework_architecture.md)

## Содержание

- [1. Функционал и продуктовые метрики](#chapter-one)
- [2. Расчет нагрузки](#chapter-two)
- [3. Глобальная балансировка нагрузки](#chapter-tree)
- [Используемые источники](#sorce)



 
<a id="chapter-one"></a>

## 1. Функционал и продуктовые метрики
__Функциональные возможности__ - это поисковая система. Она позволяет пользователям искать информацию в интернете, включая веб-страницы, изображения, видео, новости и другие типы контента.

__Целевая аудитория__ - в результате исследования данной темы, конкретного количества пользователей поисковый системы Яндекс не было найдено. Поэтому использовалась следующая логика. В основном аудитория данного сервиса - _русскоязычные пользователи интернета_ - рунет. [Согласно статистике](https://www.web-canape.ru/business/statistika-interneta-i-socsetej-na-2023-god-cifry-i-trendy-v-mire-i-v-rossii/) в России 127.6 миллионов пользователей Интернета. Согласно сервису [Яндекс Радар](https://radar.yandex.ru/search?period=all&selected_rows=iHMJ0E%252CvDPqTi%252C8fg2y0%252Ctmkupd%252CMCj1FA) пользователи Яндекса составляют 64.25% от общего числа пользователей поисковых систем. Таким образом, можно предположить, что количество пользователей составляет ``127.6E6*0.64 = 76E6``.</br>

Ниже представлена таблица, показывающая долю пользователей Яндекс из разных стран:

 Страна         |  Процент пользователей Яндекс поиска
----------------|------------------------
 Россия         |   95.04%
 Украина        |    0.89%
 Беларусь       |    0.66%
 Нидерланды     |    0.27%
 Молдова        |    0.27%
 Другие         |    2.87%

Для определения метрик DAU и MAU возьмем данные с сайта [HypeStat](https://hypestat.com/info/ya.ru):

- количество пользователей ~ 81,66M
- MAU ~ 44,9M
- DAU ~ 15,8M

__Ключевой функционал:__

- Регистрация и авторизация
- Поиск веб-страниц
- История поиска


<a id="chapter-two"></a>

## 2. Расчет нагрузки

__Продуктовые метрики__

Среднее количество действий пользователя можно оценить следующим образом. Т.к. данный сервис представляет собой поисковую систему, то вероятнее всего, что в общем случае сценарий использования сервиса следующий: пользователей заходит на главную поисковую страницу, набирает запрос и пользуется пагинатором. Согласно [5] страниц за визит 5,8 значит 3-4 перехода пользователь проводит за сеанс использования ресурса.</br>

Прикинем размер истории пользователя. Допустим, символы в истории пользователя кодируются UTF-8, тогда размер символа - 1 байт. 2 000 символов - максимальный размер URL адреса. _По собственному опыту_ ежедневного использования браузера, имею порядка 100 000 записей в истории. Таким образом, ``1 байт *2 000 символов * 100 000 записей = 200Гб``

Таким образом, имеем следующие продуктовые метрики:

 Продуктовая метрика                      |Значение
------------------------------------------|--------
 MAU                                      | 44,9М  
 DAU                                      | 15,8М
 Количество действий пользователя         | 5-6
 Среднее время на сайте                   | 6:30 мин
 Средний размер страницы                  | 3 Мб
 Количество заходов на сайт за месяц      | 500M
 Объем истории пользователя               | 200Гб


__Технические метрики__

При загрузке страницы ya.ru инструменты разработчика показали, размер страницы в среднем 3 Мб. Учитывая перемещение пользователя по 5-6 страницам, получим трафик на одного пользователя. Умножив это значение на DAU, получим суммарный суточный трафик.</br>
Пиковый трафик определим, как усредненный суточный с небольшим коэффициентом, например 1.5</br>
RPS найдем из из следующих соображений соображений, поделим DAU на секунды в дне. Получим RPS.


Техническая метрика                             |Значение
------------------------------------------------|------------------------
Пиковое потребление трафика в течении суток     | 34.5 Гбит/с
Суммарный суточный трафик                       | 248 512.5 Гбайт/сутки
RPS                                             | 183 запросов в секунду
Суммарный объем данных [11] *                   | 50 Пб
Размер индекса [8]                              | 250 ТБ

*Суммарный объем данных включает в себя и реплику и индексы.


<a id="chapter-tree"></a>

## 3. Глобальная балансировка нагрузки

Исходя из данных, представленных в первом пункте курсовой работы, можно сделать вывод, что удобнее всего расположить датацентр в Москве так, как основная аудитория находиться в России.<br>

Также имеет смысл разместить сервера на Украине, например в Киеве (без учета текущей ситуации). Таким образом, можно улучшить качество предоставляемых услуг для жителей Украины, Молдовы, Белоруссии и южных регионов России.</br>

Возможно стоит, разместить дадацентр вблизи крупного источника электроэнергии. Там разместить сетевого робота - паука, так как там будет происходить самая затратная по ресурсам операция - парсинг интернета. И сформированный индекс, реплицировать на основные сервера, в которых осуществлять поиск.</br>



Для __глобальной балансировки запросов и нагрузки__ будем использовать:

- Применим latency-based DNS , так как он позволяет эффективно распределять траффик по RTT к ближайшим серверам


<a id="sorce"></a>

## Используемые источники

1. [Статистика пользователей интернета](https://www.web-canape.ru/business/statistika-interneta-i-socsetej-na-2023-god-cifry-i-trendy-v-mire-i-v-rossii/)
1. [Яндекс инвесторам](https://ir.yandex.ru/)
1. [Яндекс Радар](https://radar.yandex.ru/search?period=all&selected_rows=iHMJ0E%252CvDPqTi%252C8fg2y0%252Ctmkupd%252CMCj1FA)
1. [Be1.ru](https://be1.ru/stat/ya.ru)
1. [SpyMetrics](https://spymetrics.ru/ru/website/ya.ru)
1. [HypeStat](https://hypestat.com/info/ya.ru)
1. [similarweb](https://www.similarweb.com/website/ya.ru/)
1. [Архитектура Поиска Яндекса](https://habr.com/ru/companies/yandex/articles/204282/)
1. [Что-то про БД](https://habr.com/ru/articles/123884/)
1. [Технологии Яндекса](https://yandex.ru/company/technologies/)
1. [Доклад про Яндекс](https://habr.com/ru/companies/yandex/articles/312716/)
1. [Что-то про поиск](https://habr.com/ru/companies/hh/articles/413261/)
1. [Статистика](https://datareportal.com/search?q=DIGITAL%202023%3A%20Rus)
1. [Контент Рунета](https://yandex.ru/company/researches/2009/ya_content_09/)


#### Дополнительно

https://habr.com/ru/companies/vk/articles/149498/
https://xakep.ru/2014/01/11/big-data-secrets/
https://habr.com/ru/companies/hh/articles/413261/
https://habr.com/ru/companies/yandex/articles/311104/
https://habr.com/ru/companies/vk/articles/167297/
